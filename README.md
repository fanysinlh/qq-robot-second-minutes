# 🍅 代币番茄钟 QQ 机器人

一个基于 QQ 机器人的智能任务管理系统，通过代币激励机制帮助用户提高工作效率和任务完成率。

## ✨ 功能特性

- **智能任务创建**：支持多种时间格式，AI智能评估任务价值
- **代币激励机制**：完成任务获得代币奖励，过期任务扣除代币
- **自动提醒系统**：每日提醒、即将到期提醒、过期处理
- **灵活任务查询**：支持按状态、关键词搜索任务
- **个人统计分析**：完成率、代币统计等数据分析
- **多AI服务支持**：支持OpenAI、DeepSeek、智谱AI等（可选）

## 🚀 快速开始

### 1. 环境准备

确保你的系统已安装 Python 3.8 或更高版本。

### 2. 安装依赖

在虚拟环境中安装依赖：

```bash
# 激活虚拟环境
venv\Scripts\Activate.ps1

# 安装依赖
pip install -r requirements.txt
```

### 3. 配置机器人

首次运行会自动创建 `config.yaml` 配置文件模板：

```python
python start_bot.py
```

编辑 `config.yaml` 文件，填入你的机器人信息：

```yaml
# QQ机器人配置
appid: "你的机器人APPID"
secret: "你的机器人SECRET"

# 管理员用户ID列表（可选）
admin_users:
  - "管理员用户ID1"

# AI服务配置（可选）
ai_service: "deepseek"  # 可选: deepseek, openai, zhipu, simple
```

### 4. 启动机器人

```bash
python start_bot.py
```

## 📝 使用指南

### 基本命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `\cr <任务名称> <截止时间>` | 创建新任务 | `\cr 完成作业 明天 18:00` |
| `\fi <任务ID>` | 完成任务 | `\fi 1` |
| `\ch` | 查看未完成任务 | `\ch` |
| `\ch -a` | 查看所有任务 | `\ch -a` |
| `\ch -f` | 查看已完成任务 | `\ch -f` |
| `\ch -s <关键词>` | 搜索任务 | `\ch -s 学习` |
| `\stats` | 查看个人统计 | `\stats` |
| `\help` | 显示帮助信息 | `\help` |

### 时间格式支持

- **标准格式**：`2024-12-25 18:00`
- **简化格式**：`12-25 18:00`
- **相对时间**：`明天 18:00`、`后天 9:30`、`3天后 15:00`
- **时长格式**：`2小时后`、`30分钟后`
- **当日时间**：`18:00`（如果时间已过则为明天）

### 任务价值评估

系统会根据以下因素智能评估任务价值：

- **任务复杂度**：根据任务描述长度和关键词
- **任务类型**：工作学习类、健康生活类、创作类等
- **时间压力**：截止时间越近，奖励越高
- **任务重要性**：根据关键词判断任务重要程度

代币范围：10-100，难度等级：
- 🔥🔥🔥 极高难度（80-100代币）
- 🔥🔥 高难度（60-79代币）
- 🔥 中等难度（40-59代币）
- ⭐ 简单任务（20-39代币）
- ✨ 轻松任务（10-19代币）

## 🤖 自动提醒功能

- **每日提醒**：每天早上8点提醒当天截止的任务
- **1小时提醒**：任务截止前1小时提醒
- **紧急提醒**：任务截止前30分钟紧急提醒
- **过期处理**：每天晚上11点处理过期任务并扣除代币

## 🔧 高级配置

### AI服务配置

如果你想使用AI来评估任务价值，可以配置以下服务：

#### DeepSeek（推荐）
```yaml
ai_service: "deepseek"
deepseek:
  api_key: "你的DeepSeek API Key"
  api_base: "https://api.deepseek.com/v1"
  model: "deepseek-chat"
```

#### OpenAI
```yaml
ai_service: "openai"
openai:
  api_key: "你的OpenAI API Key"
  api_base: "https://api.openai.com/v1"
  model: "gpt-3.5-turbo"
```

#### 智谱AI
```yaml
ai_service: "zhipu"
```

### 数据库配置

默认使用SQLite数据库，文件保存为 `token_tomato.db`。

## 📊 数据统计

机器人会记录以下统计信息：
- 当前代币数量
- 总任务数、完成数、进行中、已过期
- 任务完成率
- 累计获得/扣除代币数

## 🛠️ 开发说明

### 项目结构

```
├── database.py          # 数据库操作
├── task_evaluator.py    # 任务价值评估
├── task_manager.py      # 任务管理核心逻辑
├── scheduler.py         # 定时任务调度
├── tomato_bot.py        # QQ机器人主程序
├── start_bot.py         # 启动脚本
├── config.yaml          # 配置文件
├── requirements.txt     # 依赖包
└── README.md           # 说明文档
```

### 扩展开发

你可以通过以下方式扩展功能：

1. **自定义AI评估**：修改 `task_evaluator.py` 中的评估逻辑
2. **添加新命令**：在 `tomato_bot.py` 中添加新的命令处理
3. **数据库扩展**：在 `database.py` 中添加新的数据表和操作
4. **通知方式**：修改 `scheduler.py` 中的通知逻辑

## ⚠️ 注意事项

1. **机器人权限**：确保机器人有发送消息的权限
2. **数据备份**：定期备份 `token_tomato.db` 数据库文件
3. **API配额**：如果使用AI服务，注意API调用配额限制
4. **时区设置**：确保服务器时区设置正确

## 🐛 故障排除

### 常见问题

1. **机器人无响应**
   - 检查机器人是否在线
   - 确认配置文件中的appid和secret正确
   - 查看日志文件 `tomato_bot.log`

2. **时间解析失败**
   - 检查时间格式是否正确
   - 确认时间为未来时间

3. **数据库错误**
   - 检查数据库文件权限
   - 尝试删除数据库文件重新初始化

4. **AI评估失败**
   - 检查API密钥是否正确
   - 确认网络连接正常
   - 可以切换到 `simple` 模式使用本地评估

## 📄 许可证

本项目基于 MIT 许可证开源。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

**享受你的代币番茄钟之旅！** 🍅✨
